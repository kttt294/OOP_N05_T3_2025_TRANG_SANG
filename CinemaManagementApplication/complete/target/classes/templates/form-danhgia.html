<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thêm Đánh Giá Mới</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .custom-navbar {
        background-color: #50b2c0 !important;
      }

      .navbar-nav .nav-link {
        font-weight: 600;
        font-size: 1.05rem;
        padding: 0.5rem 1rem;
        color: #212529 !important;
        transition: all 0.3s ease;
      }

      .form-container {
        max-width: 800px;
        margin: 0 auto;
      }

      .form-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .form-section h5 {
        color: #495057;
        border-bottom: 2px solid #50b2c0;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      .rating-stars {
        font-size: 2rem;
        color: #ffc107;
        cursor: pointer;
      }

      .rating-stars:hover {
        color: #ffdb4d;
      }

      .rating-stars.selected {
        color: #ffc107;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light custom-navbar">
      <div class="container-xl">
        <a class="navbar-brand" href="/">
          <i class="fas fa-film me-2"></i>Cinema Management
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="/phim">Phim</a></li>
            <li class="nav-item">
              <a class="nav-link" href="/khachhang">Khách hàng</a>
            </li>
            <li class="nav-item"><a class="nav-link" href="/ve">Vé</a></li>
            <li class="nav-item"><a class="nav-link" href="/ghe">Ghế</a></li>
            <li class="nav-item">
              <a class="nav-link" href="/voucher">Voucher</a>
            </li>
            <li class="nav-item"><a class="nav-link" href="/doan">Đồ ăn</a></li>
            <li class="nav-item">
              <a class="nav-link" href="/danhgia">Đánh giá</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-md-8">
          <h2><i class="fas fa-star me-2"></i>Thêm Đánh Giá Mới</h2>
          <p class="text-muted">Tạo đánh giá mới cho phim</p>
        </div>
        <div class="col-md-4 text-end">
          <a href="/danhgia" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Quay lại
          </a>
        </div>
      </div>

      <!-- Alert Messages -->
      <div
        th:if="${message}"
        class="alert alert-info alert-dismissible fade show"
        role="alert"
      >
        <i class="fas fa-info-circle me-2"></i>
        <span th:text="${message}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>

      <!-- Form Container -->
      <div class="form-container">
        <form th:action="@{/danhgia/create}" method="post" id="danhGiaForm">
          <!-- Basic Information Section -->
          <div class="form-section">
            <h5><i class="fas fa-info-circle me-2"></i>Thông tin cơ bản</h5>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="maDanhGia" class="form-label"
                    >Mã đánh giá *</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="maDanhGia"
                    name="maDanhGia"
                    placeholder="VD: DG001"
                    required
                  />
                  <div class="form-text">Mã đánh giá phải là duy nhất</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="maPhim" class="form-label">Phim *</label>
                  <select
                    class="form-select"
                    id="maPhim"
                    name="maPhim"
                    required
                  >
                    <option value="">Chọn phim</option>
                    <option value="P001">Avengers: Endgame</option>
                    <option value="P002">Spider-Man: No Way Home</option>
                    <option value="P003">Black Panther</option>
                  </select>
                  <div class="form-text">Chọn phim để đánh giá</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Rating Section -->
          <div class="form-section">
            <h5><i class="fas fa-star me-2"></i>Đánh giá</h5>
            <div class="mb-3">
              <label class="form-label">Số sao *</label>
              <div class="rating-stars" id="ratingStars">
                <i class="fas fa-star" data-rating="1"></i>
                <i class="fas fa-star" data-rating="2"></i>
                <i class="fas fa-star" data-rating="3"></i>
                <i class="fas fa-star" data-rating="4"></i>
                <i class="fas fa-star" data-rating="5"></i>
              </div>
              <input type="hidden" id="soSao" name="soSao" required />
              <div class="form-text">Click vào sao để chọn số sao đánh giá</div>
            </div>
          </div>

          <!-- Review Content Section -->
          <div class="form-section">
            <h5><i class="fas fa-edit me-2"></i>Nội dung đánh giá</h5>
            <div class="mb-3">
              <label for="noiDung" class="form-label"
                >Nội dung đánh giá *</label
              >
              <textarea
                class="form-control"
                id="noiDung"
                name="noiDung"
                rows="5"
                placeholder="Viết đánh giá chi tiết về phim..."
                required
              ></textarea>
              <div class="form-text">
                Đánh giá chi tiết về phim (tối thiểu 10 ký tự)
              </div>
            </div>
          </div>

          <!-- Customer Information Section -->
          <div class="form-section">
            <h5><i class="fas fa-user me-2"></i>Thông tin khách hàng</h5>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="maKhachHang" class="form-label"
                    >Khách hàng *</label
                  >
                  <select
                    class="form-select"
                    id="maKhachHang"
                    name="maKhachHang"
                    required
                  >
                    <option value="">Chọn khách hàng</option>
                    <option value="KH001">Nguyễn Văn A</option>
                    <option value="KH002">Trần Thị B</option>
                    <option value="KH003">Lê Văn C</option>
                  </select>
                  <div class="form-text">Chọn khách hàng đánh giá</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="ngayDanhGia" class="form-label"
                    >Ngày đánh giá *</label
                  >
                  <input
                    type="datetime-local"
                    class="form-control"
                    id="ngayDanhGia"
                    name="ngayDanhGia"
                    required
                  />
                  <div class="form-text">Thời điểm đánh giá</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Information Section -->
          <div class="form-section">
            <h5><i class="fas fa-edit me-2"></i>Thông tin bổ sung</h5>
            <div class="mb-3">
              <label for="ghiChu" class="form-label">Ghi chú</label>
              <textarea
                class="form-control"
                id="ghiChu"
                name="ghiChu"
                rows="3"
                placeholder="Ghi chú thêm về đánh giá (không bắt buộc)..."
              ></textarea>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="d-flex justify-content-between">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="resetForm()"
            >
              <i class="fas fa-undo me-2"></i>Làm mới
            </button>
            <div>
              <a href="/danhgia" class="btn btn-outline-secondary me-2">
                <i class="fas fa-times me-2"></i>Hủy
              </a>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Lưu Đánh Giá
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
      $(document).ready(function () {
        // Set default date when page loads
        setDefaultDate();

        // Handle form submission
        $("#danhGiaForm").on("submit", function (e) {
          e.preventDefault();

          if (validateForm()) {
            console.log("Validation passed, submitting form...");
            this.submit();
          }
        });

        // Handle star rating
        $(".rating-stars i").on("click", function () {
          var rating = $(this).data("rating");
          $("#soSao").val(rating);

          // Update visual stars
          $(".rating-stars i").removeClass("selected");
          $(".rating-stars i").each(function (index) {
            if (index < rating) {
              $(this).addClass("selected");
            }
          });
        });

        // Hover effect for stars
        $(".rating-stars i").on("mouseenter", function () {
          var rating = $(this).data("rating");
          $(".rating-stars i").removeClass("selected");
          $(".rating-stars i").each(function (index) {
            if (index < rating) {
              $(this).addClass("selected");
            }
          });
        });

        $(".rating-stars").on("mouseleave", function () {
          var currentRating = $("#soSao").val();
          $(".rating-stars i").removeClass("selected");
          if (currentRating) {
            $(".rating-stars i").each(function (index) {
              if (index < currentRating) {
                $(this).addClass("selected");
              }
            });
          }
        });
      });

      function setDefaultDate() {
        var now = new Date();

        // Format date for datetime-local input
        var formatDate = function (date) {
          var year = date.getFullYear();
          var month = String(date.getMonth() + 1).padStart(2, "0");
          var day = String(date.getDate()).padStart(2, "0");
          var hours = String(date.getHours()).padStart(2, "0");
          var minutes = String(date.getMinutes()).padStart(2, "0");
          return year + "-" + month + "-" + day + "T" + hours + ":" + minutes;
        };

        $("#ngayDanhGia").val(formatDate(now));
      }

      function validateForm() {
        // Basic validation
        var maDanhGia = $("#maDanhGia").val().trim();
        var maPhim = $("#maPhim").val();
        var soSao = $("#soSao").val();
        var noiDung = $("#noiDung").val().trim();
        var maKhachHang = $("#maKhachHang").val();
        var ngayDanhGia = $("#ngayDanhGia").val();

        console.log("Form data:", {
          maDanhGia: maDanhGia,
          maPhim: maPhim,
          soSao: soSao,
          noiDung: noiDung,
          maKhachHang: maKhachHang,
          ngayDanhGia: ngayDanhGia,
        });

        if (
          !maDanhGia ||
          !maPhim ||
          !soSao ||
          !noiDung ||
          !maKhachHang ||
          !ngayDanhGia
        ) {
          alert("Vui lòng điền đầy đủ thông tin bắt buộc!");
          return false;
        }

        if (noiDung.length < 10) {
          alert("Nội dung đánh giá phải có ít nhất 10 ký tự!");
          return false;
        }

        if (soSao < 1 || soSao > 5) {
          alert("Số sao phải từ 1 đến 5!");
          return false;
        }

        return true;
      }

      function resetForm() {
        if (confirm("Bạn có chắc chắn muốn làm mới form?")) {
          $("#danhGiaForm")[0].reset();
          setDefaultDate();
          $("#soSao").val("");
          $(".rating-stars i").removeClass("selected");
          $(".is-invalid").removeClass("is-invalid");
          $(".invalid-feedback").remove();
        }
      }
    </script>
  </body>
</html>
