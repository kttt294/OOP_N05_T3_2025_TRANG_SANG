<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thêm Khách Hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-film me-2"></i>Cinema Management
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/phim">Phim</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/khachhang">Khách hàng</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/ve">Vé</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/suatchieu">Suất chiếu</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-user-plus me-2"></i>Thêm Khách Hàng Mới
                        </h4>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/khachhang/create}" method="post" id="customerForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="CCCD" class="form-label">CCCD *</label>
                                        <input type="text" class="form-control" id="CCCD" name="CCCD" 
                                               th:value="${khachHang?.CCCD}" required 
                                               pattern="[0-9]{12}" 
                                               title="CCCD phải có 12 chữ số">
                                        <div class="form-text">CCCD phải có đúng 12 chữ số</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ten" class="form-label">Họ tên *</label>
                                        <input type="text" class="form-control" id="ten" name="ten" 
                                               th:value="${khachHang?.ten}" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="tuoi" class="form-label">Tuổi *</label>
                                        <input type="number" class="form-control" id="tuoi" name="tuoi" 
                                               th:value="${khachHang?.tuoi}" min="1" max="120" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="sdt" class="form-label">Số điện thoại *</label>
                                        <input type="tel" class="form-control" id="sdt" name="sdt" 
                                               th:value="${khachHang?.sdt}" required 
                                               pattern="[0-9]{10,11}" 
                                               title="Số điện thoại phải có 10-11 chữ số">
                                        <div class="form-text">Số điện thoại phải có 10-11 chữ số</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email *</label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               th:value="${khachHang?.email}" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="gioiTinh" class="form-label">Giới tính *</label>
                                        <select class="form-select" id="gioiTinh" name="gioiTinh" required>
                                            <option value="">Chọn giới tính</option>
                                            <option value="Nam" th:selected="${khachHang?.gioiTinh == 'Nam'}">Nam</option>
                                            <option value="Nữ" th:selected="${khachHang?.gioiTinh == 'Nữ'}">Nữ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="diaChi" class="form-label">Địa chỉ</label>
                                        <textarea class="form-control" id="diaChi" name="diaChi" rows="3" 
                                                  th:text="${khachHang?.diaChi}"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ngheNghiep" class="form-label">Nghề nghiệp</label>
                                        <input type="text" class="form-control" id="ngheNghiep" name="ngheNghiep" 
                                               th:value="${khachHang?.ngheNghiep}">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ngaySinh" class="form-label">Ngày sinh</label>
                                        <input type="date" class="form-control" id="ngaySinh" name="ngaySinh" 
                                               th:value="${khachHang?.ngaySinh}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="soVisa" class="form-label">Số Visa</label>
                                        <input type="text" class="form-control" id="soVisa" name="soVisa" 
                                               th:value="${khachHang?.soVisa}">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <a href="/khachhang" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>Quay lại
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Lưu
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Form validation
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            var cccd = document.getElementById('CCCD').value;
            var sdt = document.getElementById('sdt').value;
            var email = document.getElementById('email').value;
            
            // Validate CCCD
            if (!/^[0-9]{12}$/.test(cccd)) {
                alert('CCCD phải có đúng 12 chữ số!');
                e.preventDefault();
                return false;
            }
            
            // Validate phone number
            if (!/^[0-9]{10,11}$/.test(sdt)) {
                alert('Số điện thoại phải có 10-11 chữ số!');
                e.preventDefault();
                return false;
            }
            
            // Validate email
            var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Email không hợp lệ!');
                e.preventDefault();
                return false;
            }
        });
        
        // Auto-calculate age from birth date
        document.getElementById('ngaySinh').addEventListener('change', function() {
            var birthDate = new Date(this.value);
            var today = new Date();
            var age = today.getFullYear() - birthDate.getFullYear();
            var monthDiff = today.getMonth() - birthDate.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            if (age >= 0 && age <= 120) {
                document.getElementById('tuoi').value = age;
            }
        });
    </script>
</body>
</html>
